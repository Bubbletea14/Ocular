<!DOCTYPE html>
<html>

<head>
    <title>Ocular Metrics Collector</title>
    <style>
        body {
            text-align: center;
            background-color: bisque;
        }

        p {
            font-family: verdana;
            font-size: 20px;
        }

    </style>
</head>

<body>
    <h1 style="color:blueviolet;">Welcome to Ocular</h1>
    <h1>User List</h1>
    <ul class="userList"></ul>

    <h1>Process List</h1>
    <ul class="processList"></ul>

    <h1>Memory List</h1>
    <ul class="memoryList"></ul>

    <h1>Cpu List</h1>
    <ul class="cpuList"></ul>


    <script>
        //Fetch data and update users
        function fetchUsers() {
            fetch('/api/v1/Users')
            .then(response => response.json())
            .then(users => {
                //Handle the response data for users
                const userListElements = document.querySelectorAll('.userList');
                userListElements.forEach(userListElement => {
                    userListElement.innerHTML = '';
                    users.forEach(user => {
                        const listUserItem = document.createElement('li');
                        listUserItem.textContent = `ID: ${user.id}, Username: ${user.username}, Email: ${user.email}`;
                        userListElement.appendChild(listUserItem);
                    });
                });
            })
            .catch(error => console.error('Error fetching users:', error));
        }

        //Fetch data from the processes API 
        function fetchProcess () {
        fetch('/api/v1/Processes')
            .then(response => response.json())
            .then(processes => {
                //Handle the response data for processes
                const processListElements = document.querySelectorAll('.processList');
                processListElements.forEach(processListElement => {
                    processListElement.innerHTML = '';
                    processes.forEach(process => {
                        const listProcessItem = document.createElement('li');
                        listProcessItem.textContent = `PID: ${process.pid}, Name: ${process.name}`;
                        processListElement.appendChild(listProcessItem);
                    }); 
                });
            })
            .catch(error => console.error('Error fetching processes:', error));
        }

        //Fetch data from the Memory API 
        function fetchMemory() {
        fetch('/api/v1/Memory')
            .then(response => response.json())
            .then(memoryData => {
                //Handle the response data for memory
                const memoryListElements = document.querySelectorAll('.memoryList');
                memoryListElements.forEach(memoryListElement => {
                    memoryListElement.innerHTML = '';
                    memoryData.forEach(memory => {
                        const listMemoryItem = document.createElement('li');
                        listMemoryItem.style.whiteSpace = 'pre-line';
                        listMemoryItem.textContent = `Memory ID: ${memory.id}\n` +
                            `Total Memory: ${memory.totalMemory}\n` +
                            `Free Memory: ${memory.freeMemory}\n` +
                            `Used Memory: ${memory.usedMemory}\n` +
                            `Memory Speed: ${memory.memorySpeed}\n` +
                            `Memory Usage Percentage: ${memory.memoryUsagePercentage}`;
                        memoryListElement.appendChild(listMemoryItem);
                    }); 
                });
            })
            .catch(error => console.error('Error fetching memory data:', error));
        }
        
        //Fetch CPU data
        //  function fetchCpu() {
        //  fetch('/api/v1/Cpu')
        //     .then(response => response.json())
        //     .then(cpu => {
        //         //Handle the response data for cpu
        //         const cpuListElements = document.querySelectorAll('.cpuList');
        //         cpuListElements.forEach(cpuListElement => {
        //             cpuListElement.innerHTML = '';
        //             cpu.forEach(cpu => {
        //                 const listCpuItem = document.createElement('li');
        //                 listCpuItem.textContent = `ID: ${cpu.id}, ProcessorType: ${cpu.processorType}, processorSpeed: ${cpu.processorSpeed}, Count:${cpu.count}, upTime:${cpu.upTime} `;
        //                 cpuListElement.appendChild(listCpuItem);
        //             });
        //         });
        //     })
        //     .catch(error => console.error('Error fetching cpu:', error));
        // }

        function fetchCpu() {
        fetch('/api/v1/Cpu')
        .then((response) => response.json())
        .then((cpuArray) => {
            // Sort the array by 'dateTime' property in ascending order
            cpuArray.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
            
            // Fetch the latest CPU record (last item after sorting)
            const latestCpu = cpuArray[cpuArray.length - 1];

            // Fetch all CPU list elements
            const cpuListElements = document.querySelectorAll('.cpuList');

            cpuListElements.forEach((cpuListElement) => {
                // Clear existing content
                cpuListElement.innerHTML = '';

                // Create a new list item for the latest CPU
                const listCpuItem = document.createElement('li');
                listCpuItem.textContent = `ID: ${latestCpu.id}, ProcessorType: ${latestCpu.processorType}, ProcessorSpeed: ${latestCpu.processorSpeed}, Count: ${latestCpu.count}, UpTime: ${latestCpu.upTime}`;

                // Append the new list item to the list element
                cpuListElement.appendChild(listCpuItem);
            });
        })
        .catch((error) => {
            console.error('Error fetching CPU data:', error);
            // Optionally display an error message in the UI
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = 'An error occurred while fetching CPU data. Please try again later.';
            }
        });
        }


        fetchUsers();
        setInterval(fetchUsers,15000);
        fetchCpu();
        setInterval(fetchCpu,15000);

        
        
        
    </script>
</body>

</html>